<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <title>Elmer I Fast build Admin dashboard for any platform</title>
    <meta name="description" content="Elmer is a Dashboard & Admin Site Responsive Template by hencework."/>
    <meta name="keywords"
          content="admin, admin dashboard, admin template, cms, crm, Elmer Admin, Elmeradmin, premium admin templates, responsive admin, sass, panel, software, ui, dwh, web app, application"/>
    <meta name="author" content="hencework"/>

    <!-- Favicon -->
    <link rel="shortcut icon" href="favicon.ico">
    <link rel="icon" href="favicon.ico" type="image/x-icon">

    <!-- Bootstrap Wysihtml5 css -->
    <link rel="stylesheet" href="vendors/bower_components/bootstrap3-wysihtml5-bower/dist/bootstrap3-wysihtml5.css"/>

    <!-- Data table CSS -->
    <link href="vendors/bower_components/datatables/media/css/jquery.dataTables.min.css" rel="stylesheet"
          type="text/css"/>

    <!-- Custom CSS -->
    <link href="dist/css/style.css" rel="stylesheet" type="text/css">
    <!-- jQuery -->
    <script src="vendors/bower_components/jquery/dist/jquery.min.js"></script>
</head>

<body>
<!--/Preloader-->
<div class="wrapper   pimary-color-blue" style="min-height: 650px">
    <!-- Main Content -->
    <!-- Row -->
    <div class="row">
        <div class="col-lg-12">
            <div class="panel panel-default card-view pa-0">
                <div class="panel-wrapper collapse in">
                    <div class="panel-body pa-0">
                        <div class="contact-list">
                            <div class="row">
                                <!-- <aside class="col-xs-1">
                                 </aside>-->
                                <aside class="col-xs-1 col-md-1">
                                </aside>

                                <aside class="col-lg-10 col-md-8 pl-0">
                                    <div class="panel pa-0">
                                        <div class="panel-wrapper collapse in">
                                            <div class="panel-body  pa-0">
                                                <div class="table-responsive mb-30">
                                                    <table id="datable_1" class="table  display table-hover mb-30"
                                                           data-page-size="10">
                                                        <thead>
                                                        <tr>
                                                            <th>编号</th>
                                                            <th>姓名</th>
                                                            <th>Email</th>
                                                            <th>电话</th>
                                                            <th>创建时间</th>
                                                            <th>修改时间</th>
                                                            <th>操作</th>
                                                        </tr>
                                                        </thead>
                                                        <tbody>

                                                        </tbody>
                                                        <aside class="col-lg-2 col-md-4 pr-0">
                                                            <div class="mt-20 mb-20 ml-15 mr-15">
                                                                <a href="#myModal" data-toggle="modal" title="Compose"
                                                                   class="btn btn-success btn-block">
                                                                    添加用户
                                                                </a>
                                                                <!-- Modal -->
                                                                <div aria-hidden="true" role="dialog" tabindex="-1"
                                                                     id="myModal"
                                                                     class="modal fade" style="display: none;">
                                                                    <div class="modal-dialog">
                                                                        <div class="modal-content">
                                                                            <div class="modal-header">
                                                                                <button type="button" class="close"
                                                                                        data-dismiss="modal"
                                                                                        aria-hidden="true">×
                                                                                </button>
                                                                                <h4 class="modal-title">添加用户</h4>
                                                                            </div>
                                                                            <div class="modal-body">
                                                                                <form class="form-horizontal form-material">
                                                                                    <div class="form-group">
                                                                                        <div class="col-md-12 mb-20">
                                                                                            <input type="text"
                                                                                                   class="form-control"
                                                                                                   placeholder="请输入用户名"
                                                                                                   id="addName"
                                                                                                   name="username">
                                                                                        </div>
                                                                                        <div class="col-md-12 mb-20">
                                                                                            <input type="password"
                                                                                                   class="form-control"
                                                                                                   placeholder="请输入密码"
                                                                                                   id="addPwd"
                                                                                                   name="password">
                                                                                        </div>
                                                                                        <div class="col-md-12 mb-20">
                                                                                            <input type="password"
                                                                                                   class="form-control"
                                                                                                   placeholder="请确认密码"
                                                                                                   id="addPwd2">
                                                                                        </div>
                                                                                        <div class="col-md-12 mb-20">
                                                                                            <input type="text"
                                                                                                   class="form-control"
                                                                                                   placeholder="请填写邮箱"
                                                                                                   id="addEmail"
                                                                                                   name="email">
                                                                                        </div>
                                                                                        <div class="col-md-12 mb-20">
                                                                                            <input type="text"
                                                                                                   class="form-control"
                                                                                                   placeholder="请填写手机号码"
                                                                                                   id="addPhone"
                                                                                                   name="phone">
                                                                                        </div>
                                                                                        <div class="form-group">
                                                                                            <span id="errMsg"></span>
                                                                                        </div>

                                                                                    </div>
                                                                                </form>
                                                                            </div>
                                                                            <div class="modal-footer">
                                                                                <button type="button"
                                                                                        class="btn btn-info waves-effect"
                                                                                        data-dismiss="modal"
                                                                                        onclick="save()">保存
                                                                                </button>
                                                                                <button type="button"
                                                                                        class="btn btn-default waves-effect"
                                                                                        data-dismiss="modal">取消
                                                                                </button>
                                                                            </div>
                                                                        </div>
                                                                        <!-- /.modal-content -->
                                                                    </div>
                                                                    <!-- /.modal-dialog -->
                                                                </div>
                                                                <!-- /.modal -->

                                                                <!-- Modal -->
                                                                <div aria-hidden="true" role="dialog" tabindex="-1"
                                                                     id="editModal"
                                                                     class="modal fade" style="display: none;">
                                                                    <div class="modal-dialog">
                                                                        <div class="modal-content">
                                                                            <div class="modal-header">
                                                                                <button type="button" class="close"
                                                                                        data-dismiss="modal"
                                                                                        aria-hidden="true">×
                                                                                </button>
                                                                                <h4 class="modal-title">修改用户</h4>
                                                                            </div>
                                                                            <div class="modal-body">
                                                                                <form class="form-horizontal form-material">
                                                                                    <div class="form-group">
                                                                                        <span id="updateIdSpan" hidden="hidden">
                                                                                            <input type="text" id="updateId">
                                                                                        </span>
                                                                                        <div class="col-md-12 mb-20">
                                                                                            用户名
                                                                                            <input type="text"
                                                                                                   class="form-control"
                                                                                                   placeholder="用户名"
                                                                                                   id="newName"
                                                                                                   name="username">
                                                                                        </div>
                                                                                        <div class="col-md-12 mb-20">
                                                                                            邮箱
                                                                                            <input type="text"
                                                                                                   class="form-control"
                                                                                                   placeholder="邮箱"
                                                                                                   id="newEmail"
                                                                                                   name="email">
                                                                                        </div>
                                                                                        <div class="col-md-12 mb-20">
                                                                                            电话
                                                                                            <input type="text"
                                                                                                   class="form-control"
                                                                                                   placeholder="手机号码"
                                                                                                   id="newPhone"
                                                                                                   name="phone">
                                                                                        </div>
                                                                                        <div class="form-group">
                                                                                            <span id="newErrMsg"></span>
                                                                                        </div>

                                                                                    </div>
                                                                                </form>
                                                                            </div>
                                                                            <div class="modal-footer">
                                                                                <button type="button"
                                                                                        class="btn btn-info waves-effect"
                                                                                        data-dismiss="modal"
                                                                                        onclick="updateById()">更新
                                                                                </button>
                                                                                <button type="button"
                                                                                        class="btn btn-default waves-effect"
                                                                                        data-dismiss="modal">取消
                                                                                </button>
                                                                            </div>
                                                                        </div>
                                                                        <!-- /.modal-content -->
                                                                    </div>
                                                                    <!-- /.modal-dialog -->
                                                                </div>
                                                                <!-- /.modal -->



                                                            </div>

                                                        </aside>
                                                    </table>
                                                    <!--分页插件-->
                                                    <nav>
                                                        <ul class="pagination">
                                                            <li>
                                                                <a href="#" aria-label="Previous" onclick="toLeft()">
                                                                    <span aria-hidden="true">&laquo;</span>
                                                                </a>
                                                            </li>
                                                            <li>
                                                                <a href="#" aria-label="Next" onclick="toRight()">
                                                                    <span aria-hidden="true">&raquo;</span>
                                                                </a>
                                                            </li>
                                                        </ul>
                                                    </nav>
                                                    <!-- 分页插件结束 -->
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </aside>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- /Row -->

</div>
<!-- /#wrapper -->

<!-- JavaScript -->

<!-- jQuery -->
<script src="vendors/bower_components/jquery/dist/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="vendors/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>

<!-- wysuhtml5 Plugin JavaScript -->
<script src="vendors/bower_components/wysihtml5x/dist/wysihtml5x.min.js"></script>

<script src="vendors/bower_components/bootstrap3-wysihtml5-bower/dist/bootstrap3-wysihtml5.all.js"></script>

<!-- Fancy Dropdown JS -->
<script src="dist/js/dropdown-bootstrap-extended.js"></script>

<!-- Bootstrap Wysuhtml5 Init JavaScript -->
<script src="dist/js/bootstrap-wysuhtml5-data.js"></script>

<!-- Data table JavaScript -->
<!--<script src="vendors/bower_components/datatables/media/js/jquery.dataTables.min.js"></script>
<script src="dist/js/dataTables-data.js"></script>-->

<!-- Slimscroll JavaScript -->
<script src="dist/js/jquery.slimscroll.js"></script>

<!-- Owl JavaScript -->
<script src="vendors/bower_components/owl.carousel/dist/owl.carousel.min.js"></script>

<!-- Switchery JavaScript -->
<script src="vendors/bower_components/switchery/dist/switchery.min.js"></script>

<!-- Init JavaScript -->
<script src="dist/js/init.js"></script>

</body>
<script>

    // 定义页数相关变量
    let prePage = 0;
    let nextPage = 0;
    let isFirstPage = false;
    let isLastPage = false;

    // 页面加载 调用一个分页查询一页数据的方法
    $(function () {
        findByPage(1); // 页面初始化 查询第一页
    })

    // 查询后台的数据 动态展示的方法
    function findByPage(pageNum) {
        // 每次查询前生成新的tr和li 所以方法前清空两项
        $("tbody tr").remove();
        $("li[name='myli']").remove();
        // 发送ajax请求 查询后台数据
        $.post("/Visualization_Lagou/user/list.do", "pageNum=" + pageNum + "&pageSize=10", function (data) {

            // 初始化页数相关变量
            prePage = data.data.prePage;
            nextPage = data.data.nextPage;
            isFirstPage = data.data.isFirstPage;
            isLastPage = data.data.isLastPage;

            // 获取到查询到的一页数据list 然后循环生成 tr和td 把数据嵌套到tr和td中 放在tbody中
            let list = data.data.list;
            for (let i = 0; i < list.length; i++) {
                let $tr = $("<tr>\n" +
                    "<th>" + list[i].id + "</th>\n" +
                    "<th>" + list[i].username + "</th>\n" +
                    "<th>" + list[i].email + "</th>\n" +
                    "<th>" + list[i].phone + "</th>\n" +
                    "<th>" + list[i].createTime + "</th>\n" +
                    "<th>" + list[i].updateTime + "</th>\n" +
                    "<th>" +
                    "<a href='#editModal' class='text-inverse pr-10' title='Edit' data-toggle='modal' onclick='updateBtn(" + list[i].id + ")'><i class=\"zmdi zmdi-edit txt-warning\"></i></a>" +
                    "<a href='javascript:void(0)' class='text-inverse' title='Delete' data-toggle='tooltip' onclick='deleteById(" + list[i].id + ")'><i class='zmdi zmdi-delete txt-danger'></i></a></th>\n" +
                    "</tr>");
                $("tbody").append($tr);
            }
            // 动态生成页码
            let totalPages = data.data.pages;
            for (let i = 0; i < totalPages; i++) {
                let $li = $("<li name='myli'><a href='#' onclick='findByPage(" + (i + 1) + ")'>" + (i + 1) + "</a></li>");
                // 将li添加到页面
                $("li:last").before($li);
                // 判断当前页是哪一页
                if (data.data.pageNum == (i + 1)) {
                    $li.prop("class", "active")
                }
            }
        }, "json")
    }

    // 点击向左的方法
    function toLeft() {
        // 判断当前页是否是首页，如果是首页，return停止方法
        if (isFirstPage) {
            return;
        } else {
            // 如果不是首页，调用findByPage(前一页)
            findByPage(prePage);
        }
    }

    // 点击向右的方法
    function toRight() {
        // 判断当前页是否是尾页，如果是尾页，return停止方法
        if (isLastPage) {
            return;
        } else {
            // 如果不是尾页，调用findByPage(后一页)
            findByPage(nextPage);
        }
    }

    // 添加用户的方法
    function save() {
        // 获取数据
        let addName = $("#addName").val();
        let addpwd = $("#addPwd").val();
        let addpwd2 = $("#addPwd2").val();
        let addEmail = $("#addEmail").val();
        let addPhone = $("#addPhone").val();

        if (addpwd != addpwd2) {
            $("#errMsg").html("两次密码不一致");
        }

        $.post("/Visualization_Lagou/user/add.do", {
            "username": addName,
            "password": addpwd,
            "email": addEmail,
            "phone": addPhone
        }, function (data) {
            if (data.status == 0) {
                alert("添加成功");
                location.reload();
            } else {
                alert("添加失败" + data.msg);
            }
        })
    }

    // 删除用户的方法
    function deleteById(id) {
        // 询问是否确认删除
        let flag = window.confirm("是否确认删除");
        if (!flag) {
            return;
        }

        // 发送ajax请求 删除后台数据 参数id
        $.post("/Visualization_Lagou/user/deleteUser.do", "id=" + id, function (data) {
            if (data.status == 0) {
                location.reload();
            }
        }, "json")
    }

    // 修改按钮请求默认value显示
    function updateBtn(id) {
        $("#updateId").attr("value",id);
        $.post("/Visualization_Lagou/user/findById.do", "id=" + id,function (data) {
            $("#newName").attr("value", data.data.username);
            $("#newEmail").attr("value", data.data.email);
            $("#newPhone").attr("value", data.data.phone);
        })
    }

    // 修改用户的方法
    function updateById() {

        let id = $("#updateId").val();
        let newName = $("#newName").val();
        let newEmail = $("#newEmail").val();
        let newPhone = $("#newPhone").val();
        // 校验邮箱合理性
        let emailValid = isEmailValid(newEmail);
        if (!emailValid){
            alert("请输入正确邮箱地址");
            location.reload();
            return ;
        }

        // 校验电话合理性
        let phoneValid = isPhoneValid(newPhone);
        if (!phoneValid){
            alert("请输入正确手机号码");
            location.reload();
            return ;
        }

        // 发送ajax请求 更新后台数据
        $.post("/Visualization_Lagou/user/update.do", {
            "id": id,
            "username": newName,
            "email": newEmail,
            "phone": newPhone
        }, function (data) {
            if (data.status == 0) {
                location.reload();
            } else {
                alert("更新失败" + data.msg)
                location.reload();
            }
        }, "json")
    }


    // 校验邮箱合理性
    function isEmailValid (email){
        var reEmail=/^([a-zA-Z0-9._%-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4})*$/;
        return reEmail.test(email);
    }

    // 校验电话合理性
    function isPhoneValid(phone){
        var rePhone = /^[1]([3-9])[0-9]{9}$/;
        return rePhone.test(phone);
    }
</script>
</html>
